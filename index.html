<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Mini Score System</title>
<style>
  body { font-family:sans-serif; max-width:400px; margin:40px auto; text-align:center; }
  input,button { padding:8px; margin:4px; width:90%; font-size:16px; }
</style>
</head>
<body>
<h2>UB Bank for UB</h2>

<div id="auth">
  <input id="user" placeholder="Username"><br>
  <input id="pass" placeholder="Password" type="password"><br>
  <button onclick="signup()">Sign Up</button>
  <button onclick="login()">Log In</button>
  <p id="authMsg"></p>
</div>

<div id="panel" style="display:none;">
  <h3>Welcome <span id="me"></span>!</h3>
  <p>Your score: <span id="score">0</span></p>
  <input id="toUser" placeholder="Send to username">
  <input id="amount" placeholder="Amount" type="number">
  <button onclick="send()">Send Score</button>
  <p id="msg"></p>
</div>

<script>
const url = "https://script.google.com/macros/s/AKfycbx8DOJZM_YI53UmpbT-u30oOHwzVaZLIA7WhSPOOOmf2EhBD1zk6e2lvZThqdlT1JdYzg/exec";
let username = "", password = "";

async function signup() {
  const u = val("user"), p = val("pass");
  const res = await post({ action:"signup", username:u, password:p });
  msg("authMsg", res);
}

async function login() {
  const u = val("user"), p = val("pass");
  const res = await post({ action:"login", username:u, password:p });
  if (res.username) {
    username=u; password=p;
    showPanel(res);
  } else msg("authMsg", res);
}

async function send() {
  const to = val("toUser");
  const amt = Number(val("amount"));
  const res = await post({ action:"send", from:username, password, to, amount:amt });
  msg("msg", res);
  refresh();
}

async function refresh() {
  const res = await post({ action:"login", username, password });
  if (res.username) document.getElementById("score").textContent = res.score;
}

function val(id){ return document.getElementById(id).value.trim(); }
function msg(id,t){ document.getElementById(id).textContent = typeof t==="string"?t:JSON.stringify(t); }
function showPanel(u){ 
  document.getElementById("auth").style.display="none";
  document.getElementById("panel").style.display="block";
  document.getElementById("me").textContent=u.username;
  document.getElementById("score").textContent=u.score;
}

async function post(data){
  const r = await fetch(url,{method:"POST",headers:{'Content-Type':'application/json'},body:JSON.stringify(data)});
  return r.json();
}
</script>
</body>
</html>
